<!DOCTYPE html>
<html>

<head>
    <style> body {background-color: #172330;} </style>
    <title>JMX24 Viewer</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=0.5"> 
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" type="text/css" href="style.css">


<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

    <meta charset="UTF-8">
</head>

<body>







    <div class="topnav"><h1>JMX24 Remote View</h1></div>
    <p><button class="button-30" id="connectBleButton" role="button"><b>View 24hr History</b></button></p>
   
   <p id="myHeader"><span id="bleState" style="color:red; font-size: 25px; "><b>Not Paired</b></span></p>
 

   <p><div id="myProgress"> <div id="myBar"></div> </div></p>

   <p id="myHeader"><span id="deviceName" style="color:red; font-size: 25px; "> </span></p>

   <h2 id="myHeader"> </h2>


 


<h2 id="myHeader">Microphone SPL (dB)</h2>
<canvas id="myCan1" width="670" height="300" style="border:1px #172330"></canvas>

<h2 id="myHeader">Ambient Light Level (Lux)</h2>
<canvas id="myCan2" width="670" height="300" style="border:1px #172330"></canvas>

<h2 id="myHeader">Air Temperature (°C)</h2>
<canvas id="myCan3" width="670" height="300" style="border:1px #172330;"></canvas>

<h2 id="myHeader">Air Relative Humidity (%)</h2>
<canvas id="myCan4" width="670" height="300" style="border:1px #172330"></canvas>

<h2 id="myHeader">Acceleration (g)</h2>
<canvas id="myCan5" width="670" height="300" style="border:1px #172330"></canvas>

<h2 id="myHeader">Ambient Colour CCT (°K)</h2>
<canvas id="myCan6" width="670" height="300" style="border:1px #172330"></canvas>

<h2 id="myHeader">Air Pressure (hPa)</h2>
<canvas id="myCan7" width="670" height="300" style="border:1px #172330"></canvas>

<h2 id="myHeader">Clock Drift (µsec)</h2>
<canvas id="myCan8" width="670" height="300" style="border:1px #172330"></canvas>

<h2 id="myHeader">GPS Satellite Constellation</h2>
<canvas id="myCan9" width="680" height="680" style="border:1px solid grey"></canvas>

<h2 id="myHeader">Fixed Satellite Signal Quality (CNR) </h2>
<canvas id="myCan10" width="670" height="300" style="border:1px #172330"></canvas>

<h2 id="myHeader"> </h2>
<p><span id="gps_pos" style="color:white; font-size: 25px; "><b> </b></span></p>
<p><span id="gps_time" style="color:white; font-size: 25px; "><b> </b></span></p>
<h2 id="myHeader"> </h2>









<div id="map"></div>







<div class="footer">
<p><a href="https://smyth-research.com/" style="color:white;">Created by Smyth-Research.com</a></p>
</div>


<script>
if('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/ble_test/sw.js');
}
</script>



</body>
<script>

    // DOM Elements
    const connectButton = document.getElementById('connectBleButton');
    const disconnectButton = document.getElementById('disconnectBleButton');
    const retrievedValue = document.getElementById('valueContainer');
    const bleStateContainer = document.getElementById('bleState');
    const bleDataContainer = document.getElementById('bleBytes');
    const timestampContainer = document.getElementById('timestamp');
    const blenameContainer = document.getElementById('deviceName'); 
    const GPS_Position = document.getElementById('gps_pos');
    const GPS_Time = document.getElementById('gps_time');



    var elem = document.getElementById("myBar");
    var temp = new DataView(new ArrayBuffer(18),0);
    var mic_var = new DataView(new ArrayBuffer((144*8)+448+64),0);
    var i,j,k,l,m,n,offset=0,draw_cnt;
    var hour, hourz1, hourz2, hourz3, hourz4;
    var x_axis=0, old=0;
	var sat_id;
	var sat_elev;
	var sat_azi;
	var sat_snr;
	var active_id;
	var sat_y;
	var sat_x;
	var sat_level;


    var c1 = document.getElementById("myCan1");
    var ctx1 = c1.getContext("2d");
    var c2 = document.getElementById("myCan2");
    var ctx2 = c2.getContext("2d");
    var c3 = document.getElementById("myCan3");
    var ctx3 = c3.getContext("2d");
    var c4 = document.getElementById("myCan4");
    var ctx4 = c4.getContext("2d");
    var c5 = document.getElementById("myCan5");
    var ctx5 = c5.getContext("2d");
    var c6 = document.getElementById("myCan6");
    var ctx6 = c6.getContext("2d");
    var c7 = document.getElementById("myCan7");
    var ctx7 = c7.getContext("2d");
    var c8 = document.getElementById("myCan8");
    var ctx8 = c8.getContext("2d");
    var c9 = document.getElementById("myCan9");
    var ctx9 = c9.getContext("2d");
    var c10 = document.getElementById("myCan10");
    var ctx10 = c10.getContext("2d");












    initialise_plots();



    //Define BLE Device Specs

    var deviceName ='Proteus-e-50016E';
    var bleService = '6e400001-c352-11e5-953d-0002a5d5c51b';
    var ledCharacteristic = '6e400002-c352-11e5-953d-0002a5d5c51b';
    var sensorCharacteristic = '6e400003-c352-11e5-953d-0002a5d5c51b';


    //Global Variables to Handle Bluetooth
    var bleServer;
    var bleServiceFound;
    var sensorCharacteristicFound;

    // Connect Button (search for BLE Devices only if BLE is available)
    connectButton.addEventListener('click', (event) => {
        if (isWebBluetoothEnabled()){
            connectToDevice();
        }
    });

    // Disconnect Button
    //disconnectButton.addEventListener('click', disconnectDevice);



    // Check if BLE is available in your Browser
    function isWebBluetoothEnabled() {
        if (!navigator.bluetooth) {
            console.log('Web Bluetooth API is not available in this browser!');
            bleStateContainer.innerHTML = "Web Bluetooth API is not available in this browser!";
            return false
        }
        console.log('Web Bluetooth API supported in this browser.');
        return true
    }






    //------------------- Connect to BLE Device and Enable Notifications ----------------------------

    function connectToDevice(){

        console.log('Initializing Bluetooth...');
        navigator.bluetooth.requestDevice({
           filters: [{namePrefix: "JMX24"}],
            optionalServices: [bleService]
        })
        .then(device => {
            console.log('Device Selected:', device.name);
            bleStateContainer.innerHTML = "<b>Downloading</b>";
            bleStateContainer.style.color = "white";
            bleStateContainer.style.fontSize = "25px";
	    blenameContainer.innerHTML = device.name.bold();
            blenameContainer.style.color = "white";
            blenameContainer.style.fontSize = "25px";

            device.addEventListener('gattservicedisconnected', onDisconnected);
            device.addEventListener('gattserverdisconnected', ongattserverdisconnected);
            return device.gatt.connect();
        })
        .then(gattServer =>{
           bleServer = gattServer;
            console.log("Connected to GATT Server");
            return bleServer.getPrimaryService(bleService);
        })
        .then(service => {
            bleServiceFound = service;
            console.log("Service discovered:", service.uuid);
            return service.getCharacteristic(sensorCharacteristic);
        })
        .then(characteristic => {
            console.log("Characteristic discovered:", characteristic.uuid);
            sensorCharacteristicFound = characteristic;
            characteristic.addEventListener('characteristicvaluechanged', handleCharacteristicChange);
            characteristic.startNotifications();
            console.log("Notifications Started.");



	offset=0;
	draw_cnt=0;
	initialise_plots();
	getHoursMinutes();

//-------------------------------------------

	ctx1.fillStyle = "white";
	ctx1.fillText(hourz4, 40, 274);   
	ctx1.fillText(hourz3, 184, 274);   
	ctx1.fillText(hourz2, 328, 274);   
	ctx1.fillText(hourz1, 473, 274);   
	ctx1.fillText(hour, 618, 274);

//-------------------------------------------

	ctx2.fillStyle = "white";
	ctx2.fillText(hourz4, 40, 274);   
	ctx2.fillText(hourz3, 184, 274);   
	ctx2.fillText(hourz2, 328, 274);   
	ctx2.fillText(hourz1, 473, 274);   
	ctx2.fillText(hour, 618, 274);

//-------------------------------------------

	ctx3.fillStyle = "white";
	ctx3.fillText(hourz4, 40, 274);   
	ctx3.fillText(hourz3, 184, 274);   
	ctx3.fillText(hourz2, 328, 274);   
	ctx3.fillText(hourz1, 473, 274);   
	ctx3.fillText(hour, 618, 274);

//-------------------------------------------

	ctx4.fillStyle = "white";
	ctx4.fillText(hourz4, 40, 274);   
	ctx4.fillText(hourz3, 184, 274);   
	ctx4.fillText(hourz2, 328, 274);   
	ctx4.fillText(hourz1, 473, 274);   
	ctx4.fillText(hour, 618, 274);

//-------------------------------------------

	ctx5.fillStyle = "white";
	ctx5.fillText(hourz4, 40, 274);   
	ctx5.fillText(hourz3, 184, 274);   
	ctx5.fillText(hourz2, 328, 274);   
	ctx5.fillText(hourz1, 473, 274);   
	ctx5.fillText(hour, 618, 274);

//-------------------------------------------

	ctx6.fillStyle = "white";
	ctx6.fillText(hourz4, 40, 274);   
	ctx6.fillText(hourz3, 184, 274);   
	ctx6.fillText(hourz2, 328, 274);   
	ctx6.fillText(hourz1, 473, 274);   
	ctx6.fillText(hour, 618, 274);

//-------------------------------------------

	ctx7.fillStyle = "white";
	ctx7.fillText(hourz4, 40, 274);   
	ctx7.fillText(hourz3, 184, 274);   
	ctx7.fillText(hourz2, 328, 274);   
	ctx7.fillText(hourz1, 473, 274);   
	ctx7.fillText(hour, 618, 274);

//-------------------------------------------

	ctx8.fillStyle = "white";
	ctx8.fillText(hourz4, 40, 274);   
	ctx8.fillText(hourz3, 184, 274);   
	ctx8.fillText(hourz2, 328, 274);   
	ctx8.fillText(hourz1, 473, 274);   
	ctx8.fillText(hour, 618, 274);


        return;
        })
        .then(value => {
            console.log("Read value: ", value);
            const decodedValue = new TextDecoder().decode(value);
            console.log("Decoded value: ", decodedValue);
            retrievedValue.innerHTML = decodedValue;



        })
        .catch(error => {
            console.log('Error: ', error);
        })
    }


//------- haven't seen this being called ------------------
    function onDisconnected(event){
        console.log('Disconnected', event.target.device.name);
        bleStateContainer.innerHTML = "Disconnected";
        bleStateContainer.style.color = "#d13a30";
        connectToDevice();
    }


//---------- called when JMX24 activates a disconnect ---------
   function ongattserverdisconnected(event){
        console.log('Remote server has disconnected');
        bleStateContainer.innerHTML = "<b>Complete</b>";
        bleStateContainer.style.color = "white";
    }



//-------------------- incoming data ------------------------------------

    function handleCharacteristicChange(event){

	temp = event.target.value
	console.log("Characteristic value array read");
	console.log("number of new bytes: ", temp.byteLength);
	console.log("current offset: ", offset);

	for(i=0;i<temp.byteLength-1;i++)
	{
		mic_var[offset+i]=temp.getUint8(i+1);
	}



	offset+=(temp.byteLength-1);


	if((offset>=144)&&(draw_cnt==0))
	{

		j=61;
		for(var i=0;i<144;i++) //draw SPL
		{
			k=mic_var[i];
			if(k==0xff) k=0;
			m=j+3;
			ctx1.rect(j, 257, 4, -k);
			ctx1.fillStyle="white";
			ctx1.fill();
			j=j+4;
		}
		draw_cnt=1;
	}


	if((offset>=288)&&(draw_cnt==1)); //draw LUX
	{
		j=61;
		for(var i=0;i<144;i++)
		{
			k=mic_var[i+144];
			if(k==0xff) k=0;
			ctx2.rect(j, 257, 4, -k);
			ctx2.fillStyle="white";
			ctx2.fill();
			j=j+4;
		}
		draw_cnt=2;
	}


	if((offset>=432)&&(draw_cnt==2)) //draw Temp
	{
		j=61;
		for(var i=0;i<144;i++)
		{
			k=mic_var[i+288];
			if(k==0xff) k=0;
			ctx3.rect(j, 257, 4, -k);
			ctx3.fillStyle="white";
			ctx3.fill();
			j=j+4;
		}
		draw_cnt=3;
	}


	if((offset>=576)&&(draw_cnt==3)) //Draw RH
	{
		j=61;
		for(var i=0;i<144;i++)
		{
			k=mic_var[i+432];
			if(k==0xff) k=0;
			ctx4.rect(j, 257, 4, -k);
			ctx4.fillStyle="white";
			ctx4.fill();
			j=j+4;
		}
		draw_cnt=4;
	}


	if((offset>=720)&&(draw_cnt==4)) //Draw ACCEL
	{
		j=61;
		for(var i=0;i<144;i++)
		{
			k=mic_var[i+576];
			if(k==128) k=127;
			if(k==0) ctx5.rect(j, 127, 4, 0);			
			else ctx5.rect(j, 127, 4, 128-k);
			ctx5.fillStyle="white";
			ctx5.fill();
			j=j+4;
		}
		draw_cnt=5;
	}




	if((offset>=864)&&(draw_cnt==5)) //draw CCT
	{
		j=61;
		for(var i=0;i<144;i++)
		{
			k=mic_var[i+720];
			if(k==0xff) k=0;
			ctx6.rect(j, 257, 4, -k);
			ctx6.fillStyle="white";
			ctx6.fill();
			j=j+4;
		}
		draw_cnt=6;
	}



	if((offset>=1008)&&(draw_cnt==6)) //draw PRESS
	{
		j=61;
		for(var i=0;i<144;i++)
		{
			k=mic_var[i+864];
			if(k==0xff) k=0;
			ctx7.rect(j, 257, 4, -k);
			ctx7.fillStyle="white";
			ctx7.fill();
			j=j+4;
		}
		draw_cnt=7;
	}



	if((offset>=1152)&&(draw_cnt==7)) //draw clk drift
	{
		j=61;
		for(var i=0;i<144;i++)
		{
			k=mic_var[i+1008];
			if(k==128) k=127;
			if(k==0) ctx8.rect(j, 127, 4, 0);			
			else ctx8.rect(j, 127, 4, 128-k);
			ctx8.fillStyle="white";
			ctx8.fill();
			j=j+4;
		}
		draw_cnt=8;
	}



	if(offset==1664) 
	{
		
//--------------------------------- visible ------------------------------------

		for(var i=0;i<100;i=i+5) //draw visible GPS satellites
		{

			sat_id=mic_var[i+1152];
			sat_elev=mic_var[i+1153];
			sat_azi=mic_var[i+1154]+(mic_var[i+1155]*256);
			sat_snr=mic_var[i+1156];

			calculate_sat_coords(sat_id, sat_elev, sat_azi);

			ctx9.beginPath();
			ctx9.arc(340+(sat_x*299), 340+(sat_y*299), 7, 0, 2 * Math.PI);
			ctx9.strokeStyle = "#00d81a"; //green
			ctx9.stroke();
		}	


		for(var i=100;i<200;i=i+5) //draw visible BEI satellites
		{

			sat_id=mic_var[i+1152];
			sat_elev=mic_var[i+1153];
			sat_azi=mic_var[i+1154]+(mic_var[i+1155]*256);
			sat_snr=mic_var[i+1156];

			calculate_sat_coords(sat_id, sat_elev, sat_azi);

			ctx9.beginPath();
			ctx9.arc(340+(sat_x*299), 340+(sat_y*299), 7, 0, 2 * Math.PI);
			ctx9.strokeStyle = "#ffec02"; //yellow
			ctx9.stroke();
		}


		for(var i=200;i<300;i=i+5) //draw visible GLO satellites
		{

			sat_id=mic_var[i+1152];
			sat_elev=mic_var[i+1153];
			sat_azi=mic_var[i+1154]+(mic_var[i+1155]*256);
			sat_snr=mic_var[i+1156];

			calculate_sat_coords(sat_id, sat_elev, sat_azi);

			ctx9.beginPath();
			ctx9.arc(340+(sat_x*299), 340+(sat_y*299), 7, 0, 2 * Math.PI);
			ctx9.strokeStyle = "red";
			ctx9.stroke();
		}


		for(var i=300;i<400;i=i+5) //draw visible GAL satellites
		{

			sat_id=mic_var[i+1152];
			sat_elev=mic_var[i+1153];
			sat_azi=mic_var[i+1154]+(mic_var[i+1155]*256);
			sat_snr=mic_var[i+1156];

			calculate_sat_coords(sat_id, sat_elev, sat_azi);

			ctx9.beginPath();
			ctx9.arc(340+(sat_x*299), 340+(sat_y*299), 7, 0, 2 * Math.PI);
			ctx9.strokeStyle = "#00a6ff"; //blue
			ctx9.stroke();
		}
	

//------------------------------------------ active ------------------------------------	

		for(var i=0;i<12;i++) //fill active GPS satellites
		{
			active_id=mic_var[i+1552];
			if(active_id)
			{
				for(var j=0;j<100;j=j+5)
				{
					sat_id=mic_var[j+1152];
					sat_elev=mic_var[j+1153];
					sat_azi=mic_var[j+1154]+(mic_var[j+1155]*256);
				   	if(sat_id==active_id) break;
				}

				calculate_sat_coords(sat_id, sat_elev, sat_azi);
				ctx9.beginPath();
				ctx9.arc(340+(sat_x*299), 340+(sat_y*299), 10, 0, 2 * Math.PI);
				ctx9.fillStyle="#00d81a"; //green
				ctx9.fill();
			}	
		}

		for(var i=0;i<12;i++) //fill active BEI satellites
		{
			active_id=mic_var[i+1552+12];
			if(active_id)
			{
				for(var j=100;j<200;j=j+5)
				{
					sat_id=mic_var[j+1152];
					sat_elev=mic_var[j+1153];
					sat_azi=mic_var[j+1154]+(mic_var[j+1155]*256);
				   	if(sat_id==active_id) break;
				}

				calculate_sat_coords(sat_id, sat_elev, sat_azi);
				ctx9.beginPath();
				ctx9.arc(340+(sat_x*299), 340+(sat_y*299), 10, 0, 2 * Math.PI);
				ctx9.fillStyle="#ffec02"; //yellow
				ctx9.fill();
			}	
		}

		for(var i=0;i<12;i++) //fill active GLO satellites
		{
			active_id=mic_var[i+1552+24];
			if(active_id)
			{
				for(var j=200;j<300;j=j+5)
				{
					sat_id=mic_var[j+1152];
					sat_elev=mic_var[j+1153];
					sat_azi=mic_var[j+1154]+(mic_var[j+1155]*256);
				   	if(sat_id==active_id) break;
				}

				calculate_sat_coords(sat_id, sat_elev, sat_azi);
				ctx9.beginPath();
				ctx9.arc(340+(sat_x*299), 340+(sat_y*299), 10, 0, 2 * Math.PI);
				ctx9.fillStyle="red";
				ctx9.fill();
			}	
		}	

		for(var i=0;i<12;i++) //fill active GAL satellites
		{
			active_id=mic_var[i+1552+36];
			if(active_id)
			{
				for(var j=300;j<400;j=j+5)
				{
					sat_id=mic_var[j+1152];
					sat_elev=mic_var[j+1153];
					sat_azi=mic_var[j+1154]+(mic_var[j+1155]*256);
				   	if(sat_id==active_id) break;
				}

				calculate_sat_coords(sat_id, sat_elev, sat_azi);
				ctx9.beginPath();
				ctx9.arc(340+(sat_x*299), 340+(sat_y*299), 10, 0, 2 * Math.PI);
				ctx9.fillStyle="#00a6ff"; //blue
				ctx9.fill();
			}	
		}

//----------------------------- Signal levels ----------------------------------

	

		for(var i=0;i<12;i++) //draw fixed GPS satellite signal level
		{
			ctx10.fillStyle ="#00d81a"; //green
			active_id=mic_var[i+1552];
			if(active_id)
			{
				for(var j=0;j<100;j=j+5)
				{
					sat_id=mic_var[j+1152];
					sat_level=mic_var[j+1156];
				   	if(sat_id==active_id) break;
				}

				var height=sat_level*5.12;
				ctx10.fillRect(60+(i*12), 257-height, 11, height);
			}	
		}



		for(var i=0;i<12;i++) //draw fixed BEI satellite signal level
		{
			ctx10.fillStyle = "#ffec02"; //yellow
			active_id=mic_var[i+1552+12];
			if(active_id)
			{
				for(var j=100;j<200;j=j+5)
				{
					sat_id=mic_var[j+1152];
					sat_level=mic_var[j+1156];
				   	if(sat_id==active_id) break;
				}

				var height=sat_level*5.12;
				ctx10.fillRect(145+60+(i*12), 257-height, 11, height);
			}	
		}



		for(var i=0;i<12;i++) //draw fixed GLO satellite signal level
		{
			ctx10.fillStyle = "red";
			active_id=mic_var[i+1552+24];
			if(active_id)
			{
				for(var j=200;j<300;j=j+5)
				{
					sat_id=mic_var[j+1152];
					sat_level=mic_var[j+1156];
				   	if(sat_id==active_id) break;
				}

				var height=sat_level*5.12;
				ctx10.fillRect(289+60+(i*12), 257-height, 11, height);
			}	
		}


		for(var i=0;i<12;i++) //draw fixed GAL satellite signal level
		{
			ctx10.fillStyle = "#00a6ff"; //blue
			active_id=mic_var[i+1552+36];
			if(active_id)
			{
				for(var j=300;j<400;j=j+5)
				{
					sat_id=mic_var[j+1152];
					sat_level=mic_var[j+1156];
				   	if(sat_id==active_id) break;
				}

				var height=sat_level*5.12;
				ctx10.fillRect(433+60+(i*12), 257-height, 11, height);
			}	
		}


//------------------------------ Position/Date/Time ---------------------------------



	var latitude=mic_var[1601];
	var sign=0;
	if(latitude>127)
	{
		sign=1;
		latitude+=-128;
	}

	latitude+=mic_var[1602]/100;
	latitude+=mic_var[1603]/10000;
	latitude+=mic_var[1604]/1000000;
	if(sign) latitude=-latitude;
	let l=latitude.toFixed(6);

	var longitude=mic_var[1605];
	sign=0;
	if(longitude>127)
	{
		sign=1;
		longitude+=-128;
	}

	longitude=longitude*100;
	longitude+=mic_var[1606];
	longitude+=mic_var[1607]/100;
	longitude+=mic_var[1608]/10000;
	longitude+=mic_var[1609]/1000000;
	if(sign) longitude=-longitude;
	let g=longitude.toFixed(6);

	GPS_Position.innerHTML="<b>Global Position: " + l + ", " + g;

	var month;
	if(mic_var[1614]==1) month="Jan";
	if(mic_var[1614]==2) month="Feb";
	if(mic_var[1614]==3) month="Mar";
	if(mic_var[1614]==4) month="Apr";
	if(mic_var[1614]==5) month="May";
	if(mic_var[1614]==6) month="Jun";
	if(mic_var[1614]==7) month="Jul";
	if(mic_var[1614]==8) month="Aug";
	if(mic_var[1614]==9) month="Sep";
	if(mic_var[1614]==10) month="Oct";
	if(mic_var[1614]==11) month="Nov";
	if(mic_var[1614]==12) month="Dec";

	var year=mic_var[1615]+2000;

	GPS_Time.innerHTML="<b>UCT <b/>" + mic_var[1610] + ":" + mic_var[1611] +  ":" + mic_var[1612] + "  "  + mic_var[1613] + "-" + month + "-" + year;





//----------------------- Leaflet ----------------------------------

	var map = L.map('map').setView([latitude, longitude], 13);

	L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    	maxZoom: 19,
//    	attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
	}).addTo(map);

	var marker = L.marker([latitude, longitude]).addTo(map);






	}


   	
	
	elem.style.width = ((offset*350)/1664) + "px";

	//if(offset>1088) offset=0;





 //       timestampContainer.innerHTML = getDateTime();
    }


//----------------------------------------------------------------------------------

function calculate_sat_coords(sat_id, sat_elev, sat_azi)
{
var x,y,amp,angle;
			if(sat_id)
			{
				if(sat_azi<=90.0)
				{
					amp=(90-sat_elev)/90;
					angle=((90-sat_azi)/360)*6.2831853;
					y=Math.sin(angle);
					x=Math.cos(angle);
					sat_y=y*(-amp);
					sat_x=x*amp;
				}
				else if(sat_azi<=180.0)
				{
					amp=(90-sat_elev)/90;
					angle=((180-sat_azi)/360)*6.2831853;
					y=Math.sin(angle);
					x=Math.cos(angle);
					sat_y=y*amp;
					sat_x=x*amp;
				}
				else if(sat_azi<=270.0)
				{
					amp=(90-sat_elev)/90;
					angle=((270-sat_azi)/360)*6.2831853;
					y=Math.sin(angle);
					x=Math.cos(angle);
					sat_y=y*amp;
					sat_x=x*(-amp);
				}
				else 
				{
					amp=(90-sat_elev)/90;
					angle=((360-sat_azi)/360)*6.2831853;
					y=Math.sin(angle);
					x=Math.cos(angle);
					sat_y=y*(-amp);
					sat_x=x*(-amp);
				}		
			}
} 


//------------------------------------------------------------

    function disconnectDevice() {
        console.log("Disconnect Device.");


	ctx1.clearRect(61, 2, 576, 255);
	ctx1.clearRect(20, 259, 645, 20);

	ctx2.clearRect(61, 2, 576, 255);
	ctx2.clearRect(20, 259, 645, 20);

	ctx3.clearRect(61, 2, 576, 255);
	ctx3.clearRect(20, 259, 640, 20);

	ctx4.clearRect(61, 2, 576, 255);
	ctx4.clearRect(20, 259, 640, 20);

	ctx5.clearRect(61, 2, 576, 255);
	ctx5.clearRect(20, 259, 640, 20);

	ctx6.clearRect(61, 2, 576, 255);
	ctx6.clearRect(20, 259, 640, 20);

	ctx7.clearRect(61, 2, 576, 255);
	ctx7.clearRect(20, 259, 640, 20);

	ctx8.clearRect(61, 2, 576, 255);
	ctx8.clearRect(20, 259, 640, 20);

	offset=0;
	bleDataContainer.innerHTML = offset;

        if (bleServer && bleServer.connected) {
            if (sensorCharacteristicFound) {
                sensorCharacteristicFound.stopNotifications()
                    .then(() => {
                        console.log("Notifications Stopped");
                        return bleServer.disconnect();
                    })
                    .then(() => {
                        console.log("Device Disconnected");
                        bleStateContainer.innerHTML = "Disconnected";
                        bleStateContainer.style.color = "red";

                    })
                    .catch(error => {
                        console.log("An error occurred:", error);
                    });
            } else {
                console.log("No characteristic found to disconnect.");
            }
        } else {
            // Throw an error if Bluetooth is not connected
            console.error("Bluetooth is not connected.");
            window.alert("Bluetooth is not connected.")
        }
    }

//---------------------------------------------------------------------
    function getDateTime() {
        var currentdate = new Date();
        var day = ("00" + currentdate.getDate()).slice(-2); // Convert day to string and slice
        var month = ("00" + (currentdate.getMonth() + 1)).slice(-2);
        var year = currentdate.getFullYear();
        var hours = ("00" + currentdate.getHours()).slice(-2);
        var minutes = ("00" + currentdate.getMinutes()).slice(-2);
        var seconds = ("00" + currentdate.getSeconds()).slice(-2);

        var datetime = day + "/" + month + "/" + year + " at " + hours + ":" + minutes + ":" + seconds;
        return datetime;
    }

//-------------------------------------------------------------------
    function getHoursMinutes() {
        var currentdate = new Date();
        var hours = ("00" + currentdate.getHours()).slice(-2);
        var minutes = ("00" + currentdate.getMinutes()).slice(-2);
	var temp=minutes/10;
	temp=Math.trunc(temp);
	minutes=temp*10;

	temp=hours;
	temp++;
	temp--;

	if(minutes!=0)
	{
        	if(temp<10) {hour = "0" + temp + ":" + minutes;} else {hour = temp + ":" + minutes;}
		temp=temp-6;
		if(temp<0) temp+=24;
        	if(temp<10) {hourz1 = "0" + temp + ":" + minutes;} else {hourz1 = temp + ":" + minutes;}
		temp=temp-6;
		if(temp<0) temp+=24;
        	if(temp<10) {hourz2 = "0" + temp + ":" + minutes;} else {hourz2 = temp + ":" + minutes;}
		temp=temp-6;
		if(temp<0) temp+=24;
        	if(temp<10) {hourz3 = "0" + temp + ":" + minutes;} else {hourz3 = temp + ":" + minutes;}
		temp=temp-6;
		if(temp<0) temp+=24;
        	if(temp<10) {hourz4 = "0" + temp + ":" + minutes + " (yesterday)";} else {hourz4 = temp + ":" + minutes + " (yesterday)";}
	}
	else
	{
       		if(temp<10) {hour = "0" + temp + ":" + minutes + "0";} else {hour = temp + ":" + minutes + "0";} 
		temp=temp-6;
		if(temp<0) temp+=24;
       		if(temp<10) {hourz1 = "0" + temp + ":" + minutes + "0";} else {hourz1 = temp + ":" + minutes + "0";} 
		temp=temp-6;
		if(temp<0) temp+=24;
       		if(temp<10) {hourz2 = "0" + temp + ":" + minutes + "0";} else {hourz2 = temp + ":" + minutes + "0";} 
		temp=temp-6;
		if(temp<0) temp+=24;
       		if(temp<10) {hourz3 = "0" + temp + ":" + minutes + "0";} else {hourz3 = temp + ":" + minutes + "0";} 
		temp=temp-6;
		if(temp<0) temp+=24;
       		if(temp<10) {hourz4 = "0" + temp + ":" + minutes + "0" + " (yesterday)";} else {hourz4 = temp + ":" + minutes + "0" + " (yesterday)";} 

	}

    }




//=============================================================
// Draws plot boxes + annotation
//=============================================================


    function initialise_plots(){

	offset=0;
	elem.style.width = ((offset*350)/1150) + "px";


//------------------------------------------------

	ctx1.clearRect(20, 259, 645, 20);
	ctx1.fillStyle="#2A4059";
	ctx1.fillRect(60,1,578,257);
	ctx1.font = "15px Arial";
	ctx1.lineWidth = 1;
	ctx1.fillStyle="white";
	ctx1.fillText("120", 29, 11);   
	ctx1.fillText("100", 29, 60);   
	ctx1.fillText("80", 37, 110);   
	ctx1.fillText("60", 37, 160);   
	ctx1.fillText("40", 37, 210);   
    
	ctx1.fillStyle = "black";
	
	ctx1.fillRect(144+60, 1, 1, 256);
	ctx1.fillRect(288+60, 1, 1, 256);
	ctx1.fillRect(432+60, 1, 1, 256);

	ctx1.fillRect(24+60, 1, 1, 10);
	ctx1.fillRect(48+60, 1, 1, 10);
	ctx1.fillRect(72+60, 1, 1, 10);
	ctx1.fillRect(96+60, 1, 1, 10);
	ctx1.fillRect(120+60, 1, 1, 10);

	ctx1.fillRect(168+60, 1, 1, 10);
	ctx1.fillRect(192+60, 1, 1, 10);
	ctx1.fillRect(216+60, 1, 1, 10);
	ctx1.fillRect(240+60, 1, 1, 10);
	ctx1.fillRect(264+60, 1, 1, 10);

	ctx1.fillRect(312+60, 1, 1, 10);
	ctx1.fillRect(336+60, 1, 1, 10);
	ctx1.fillRect(360+60, 1, 1, 10);
	ctx1.fillRect(384+60, 1, 1, 10);
	ctx1.fillRect(408+60, 1, 1, 10);

	ctx1.fillRect(456+60, 1, 1, 10);
	ctx1.fillRect(480+60, 1, 1, 10);
	ctx1.fillRect(504+60, 1, 1, 10);
	ctx1.fillRect(528+60, 1, 1, 10);
	ctx1.fillRect(552+60, 1, 1, 10);


//----------------------------------------------

	ctx2.clearRect(20, 259, 645, 20);
	ctx2.fillStyle = "#2A4059";
	ctx2.fillRect(60, 1, 578, 257);
	ctx2.font = "15px Arial";
	ctx2.lineWidth = 1;
        ctx2.fillStyle="white";
	ctx2.fillText("100k", 21, 11);   
	ctx2.fillText("10k", 28, 37);   
	ctx2.fillText("1k", 35, 69);   
	ctx2.fillText("100", 27, 101);   
	ctx2.fillText("10", 35, 133);   
	ctx2.fillText("1", 42, 165);   
	ctx2.fillText("0.1", 31, 197);   
	ctx2.fillText("0.01", 24, 229);   
  
	ctx2.fillStyle = "black";
	
	ctx2.fillRect(144+60, 1, 1, 256);
	ctx2.fillRect(288+60, 1, 1, 256);
	ctx2.fillRect(432+60, 1, 1, 256);

	ctx2.fillRect(24+60, 1, 1, 10);
	ctx2.fillRect(48+60, 1, 1, 10);
	ctx2.fillRect(72+60, 1, 1, 10);
	ctx2.fillRect(96+60, 1, 1, 10);
	ctx2.fillRect(120+60, 1, 1, 10);

	ctx2.fillRect(168+60, 1, 1, 10);
	ctx2.fillRect(192+60, 1, 1, 10);
	ctx2.fillRect(216+60, 1, 1, 10);
	ctx2.fillRect(240+60, 1, 1, 10);
	ctx2.fillRect(264+60, 1, 1, 10);

	ctx2.fillRect(312+60, 1, 1, 10);
	ctx2.fillRect(336+60, 1, 1, 10);
	ctx2.fillRect(360+60, 1, 1, 10);
	ctx2.fillRect(384+60, 1, 1, 10);
	ctx2.fillRect(408+60, 1, 1, 10);

	ctx2.fillRect(456+60, 1, 1, 10);
	ctx2.fillRect(480+60, 1, 1, 10);
	ctx2.fillRect(504+60, 1, 1, 10);
	ctx2.fillRect(528+60, 1, 1, 10);
	ctx2.fillRect(552+60, 1, 1, 10);


//----------------------------------------------

	ctx3.clearRect(20, 259, 640, 20);
	ctx3.fillStyle = "#2A4059";
	ctx3.fillRect(60, 1, 578, 257);
	ctx3.font = "15px Arial";
	ctx3.lineWidth = 1;
        ctx3.fillStyle="white";
	ctx3.fillText("30", 35, 11);   
	ctx3.fillText("25", 35, 37);   
	ctx3.fillText("20", 35, 69);   
	ctx3.fillText("15", 35, 101);   
	ctx3.fillText("10", 35, 133);   
	ctx3.fillText("5", 40, 165);   
	ctx3.fillText("0", 40, 197);   
	ctx3.fillText("-5", 35, 229);   
  
	ctx3.fillStyle = "black";
	
	ctx3.fillRect(144+60, 1, 1, 256);
	ctx3.fillRect(288+60, 1, 1, 256);
	ctx3.fillRect(432+60, 1, 1, 256);

	ctx3.fillRect(24+60, 1, 1, 10);
	ctx3.fillRect(48+60, 1, 1, 10);
	ctx3.fillRect(72+60, 1, 1, 10);
	ctx3.fillRect(96+60, 1, 1, 10);
	ctx3.fillRect(120+60, 1, 1, 10);

	ctx3.fillRect(168+60, 1, 1, 10);
	ctx3.fillRect(192+60, 1, 1, 10);
	ctx3.fillRect(216+60, 1, 1, 10);
	ctx3.fillRect(240+60, 1, 1, 10);
	ctx3.fillRect(264+60, 1, 1, 10);

	ctx3.fillRect(312+60, 1, 1, 10);
	ctx3.fillRect(336+60, 1, 1, 10);
	ctx3.fillRect(360+60, 1, 1, 10);
	ctx3.fillRect(384+60, 1, 1, 10);
	ctx3.fillRect(408+60, 1, 1, 10);

	ctx3.fillRect(456+60, 1, 1, 10);
	ctx3.fillRect(480+60, 1, 1, 10);
	ctx3.fillRect(504+60, 1, 1, 10);
	ctx3.fillRect(528+60, 1, 1, 10);
	ctx3.fillRect(552+60, 1, 1, 10);


//----------------------------------------------

	ctx4.clearRect(20, 259, 640, 20);
	ctx4.fillStyle = "#2A4059";
	ctx4.fillRect(60, 1, 578, 257);
	ctx4.font = "15px Arial";
	ctx4.lineWidth = 1;
        ctx4.fillStyle="white";
	ctx4.fillText("100", 28, 11);   
	ctx4.fillText("90", 35, 37);   
	ctx4.fillText("80", 35, 69);   
	ctx4.fillText("70", 35, 101);   
	ctx4.fillText("60", 35, 133);   
	ctx4.fillText("50", 35, 165);   
	ctx4.fillText("40", 35, 197);   
	ctx4.fillText("30", 35, 229);   
  
 	ctx4.fillStyle = "black";
	
	ctx4.fillRect(144+60, 1, 1, 256);
	ctx4.fillRect(288+60, 1, 1, 256);
	ctx4.fillRect(432+60, 1, 1, 256);

	ctx4.fillRect(24+60, 1, 1, 10);
	ctx4.fillRect(48+60, 1, 1, 10);
	ctx4.fillRect(72+60, 1, 1, 10);
	ctx4.fillRect(96+60, 1, 1, 10);
	ctx4.fillRect(120+60, 1, 1, 10);

	ctx4.fillRect(168+60, 1, 1, 10);
	ctx4.fillRect(192+60, 1, 1, 10);
	ctx4.fillRect(216+60, 1, 1, 10);
	ctx4.fillRect(240+60, 1, 1, 10);
	ctx4.fillRect(264+60, 1, 1, 10);

	ctx4.fillRect(312+60, 1, 1, 10);
	ctx4.fillRect(336+60, 1, 1, 10);
	ctx4.fillRect(360+60, 1, 1, 10);
	ctx4.fillRect(384+60, 1, 1, 10);
	ctx4.fillRect(408+60, 1, 1, 10);

	ctx4.fillRect(456+60, 1, 1, 10);
	ctx4.fillRect(480+60, 1, 1, 10);
	ctx4.fillRect(504+60, 1, 1, 10);
	ctx4.fillRect(528+60, 1, 1, 10);
	ctx4.fillRect(552+60, 1, 1, 10); 

//----------------------------------------------

	ctx5.clearRect(20, 259, 640, 20);
	ctx5.fillStyle = "#2A4059";
	ctx5.fillRect(60, 1, 578, 257);
	ctx5.font = "15px Arial";
	ctx5.lineWidth = 1;
        ctx5.fillStyle="white";
	ctx5.fillText("1.0", 32, 11);   
	ctx5.fillText("0.75", 24, 37);   
	ctx5.fillText("0.50", 24, 69);   
	ctx5.fillText("0.25", 24, 101);   
	ctx5.fillText("0", 44, 133);   
	ctx5.fillText("-0.25", 20, 165);   
	ctx5.fillText("-0.50", 20, 197);   
	ctx5.fillText("-0.75", 20, 229);   
  
	ctx5.fillStyle = "black";
	
	ctx5.fillRect(144+60, 1, 1, 256);
	ctx5.fillRect(288+60, 1, 1, 256);
	ctx5.fillRect(432+60, 1, 1, 256);

	ctx5.fillRect(24+60, 1, 1, 10);
	ctx5.fillRect(48+60, 1, 1, 10);
	ctx5.fillRect(72+60, 1, 1, 10);
	ctx5.fillRect(96+60, 1, 1, 10);
	ctx5.fillRect(120+60, 1, 1, 10);

	ctx5.fillRect(168+60, 1, 1, 10);
	ctx5.fillRect(192+60, 1, 1, 10);
	ctx5.fillRect(216+60, 1, 1, 10);
	ctx5.fillRect(240+60, 1, 1, 10);
	ctx5.fillRect(264+60, 1, 1, 10);

	ctx5.fillRect(312+60, 1, 1, 10);
	ctx5.fillRect(336+60, 1, 1, 10);
	ctx5.fillRect(360+60, 1, 1, 10);
	ctx5.fillRect(384+60, 1, 1, 10);
	ctx5.fillRect(408+60, 1, 1, 10);

	ctx5.fillRect(456+60, 1, 1, 10);
	ctx5.fillRect(480+60, 1, 1, 10);
	ctx5.fillRect(504+60, 1, 1, 10);
	ctx5.fillRect(528+60, 1, 1, 10);
	ctx5.fillRect(552+60, 1, 1, 10); 

//----------------------------------------------

	ctx6.clearRect(20, 259, 640, 20);
	ctx6.fillStyle = "#2A4059";
	ctx6.fillRect(60, 1, 578, 257);
	ctx6.font = "15px Arial";
	ctx6.lineWidth = 1;
        ctx6.fillStyle="white";
	ctx6.fillText("10k", 28, 11);   
	ctx6.fillText("9k", 35, 33);   
	ctx6.fillText("8k", 35, 62);   
	ctx6.fillText("7k", 35, 90);   
	ctx6.fillText("6k", 35, 119);   
	ctx6.fillText("5k", 35, 147);   
	ctx6.fillText("4k", 35, 176);   
	ctx6.fillText("3k", 35, 204);   
	ctx6.fillText("2k", 35, 233);   
  
	ctx6.fillStyle = "black";
	
	ctx6.fillRect(144+60, 1, 1, 256);
	ctx6.fillRect(288+60, 1, 1, 256);
	ctx6.fillRect(432+60, 1, 1, 256);

	ctx6.fillRect(24+60, 1, 1, 10);
	ctx6.fillRect(48+60, 1, 1, 10);
	ctx6.fillRect(72+60, 1, 1, 10);
	ctx6.fillRect(96+60, 1, 1, 10);
	ctx6.fillRect(120+60, 1, 1, 10);

	ctx6.fillRect(168+60, 1, 1, 10);
	ctx6.fillRect(192+60, 1, 1, 10);
	ctx6.fillRect(216+60, 1, 1, 10);
	ctx6.fillRect(240+60, 1, 1, 10);
	ctx6.fillRect(264+60, 1, 1, 10);

	ctx6.fillRect(312+60, 1, 1, 10);
	ctx6.fillRect(336+60, 1, 1, 10);
	ctx6.fillRect(360+60, 1, 1, 10);
	ctx6.fillRect(384+60, 1, 1, 10);
	ctx6.fillRect(408+60, 1, 1, 10);

	ctx6.fillRect(456+60, 1, 1, 10);
	ctx6.fillRect(480+60, 1, 1, 10);
	ctx6.fillRect(504+60, 1, 1, 10);
	ctx6.fillRect(528+60, 1, 1, 10);
	ctx6.fillRect(552+60, 1, 1, 10);

//----------------------------------------------

	ctx7.clearRect(20, 259, 640, 20);
	ctx7.fillStyle = "#2A4059";
	ctx7.fillRect(60, 1, 578, 257);
	ctx7.font = "15px Arial";
	ctx7.lineWidth = 1;
        ctx7.fillStyle="white";
	ctx7.fillText("1060", 20, 11);   
	ctx7.fillText("1040", 20, 37);   
	ctx7.fillText("1020", 20, 69);   
	ctx7.fillText("1000", 20, 101);   
	ctx7.fillText("980", 25, 133);   
	ctx7.fillText("960", 25, 165);   
	ctx7.fillText("940", 25, 197);   
	ctx7.fillText("920", 25, 229);   
  
	ctx7.fillStyle = "black";
	
	ctx7.fillRect(144+60, 1, 1, 256);
	ctx7.fillRect(288+60, 1, 1, 256);
	ctx7.fillRect(432+60, 1, 1, 256);

	ctx7.fillRect(24+60, 1, 1, 10);
	ctx7.fillRect(48+60, 1, 1, 10);
	ctx7.fillRect(72+60, 1, 1, 10);
	ctx7.fillRect(96+60, 1, 1, 10);
	ctx7.fillRect(120+60, 1, 1, 10);

	ctx7.fillRect(168+60, 1, 1, 10);
	ctx7.fillRect(192+60, 1, 1, 10);
	ctx7.fillRect(216+60, 1, 1, 10);
	ctx7.fillRect(240+60, 1, 1, 10);
	ctx7.fillRect(264+60, 1, 1, 10);

	ctx7.fillRect(312+60, 1, 1, 10);
	ctx7.fillRect(336+60, 1, 1, 10);
	ctx7.fillRect(360+60, 1, 1, 10);
	ctx7.fillRect(384+60, 1, 1, 10);
	ctx7.fillRect(408+60, 1, 1, 10);

	ctx7.fillRect(456+60, 1, 1, 10);
	ctx7.fillRect(480+60, 1, 1, 10);
	ctx7.fillRect(504+60, 1, 1, 10);
	ctx7.fillRect(528+60, 1, 1, 10);
	ctx7.fillRect(552+60, 1, 1, 10);

//----------------------------------------------

	ctx8.clearRect(20, 259, 640, 20);
	ctx8.fillStyle = "#2A4059";
	ctx8.fillRect(60, 1, 578, 257);
	ctx8.font = "15px Arial";
	ctx8.lineWidth = 1;
        ctx8.fillStyle="white";
	ctx8.fillText("20", 35, 11);   
	ctx8.fillText("15", 35, 37);   
	ctx8.fillText("10", 35, 69);   
	ctx8.fillText("5", 40, 101);   
	ctx8.fillText("0", 40, 133);   
	ctx8.fillText("-5", 35, 165);   
	ctx8.fillText("-10", 30, 197);   
	ctx8.fillText("-15", 30, 229);   
  
	ctx8.fillStyle = "black";
	
	ctx8.fillRect(144+60, 1, 1, 256);
	ctx8.fillRect(288+60, 1, 1, 256);
	ctx8.fillRect(432+60, 1, 1, 256);

	ctx8.fillRect(24+60, 1, 1, 10);
	ctx8.fillRect(48+60, 1, 1, 10);
	ctx8.fillRect(72+60, 1, 1, 10);
	ctx8.fillRect(96+60, 1, 1, 10);
	ctx8.fillRect(120+60, 1, 1, 10);

	ctx8.fillRect(168+60, 1, 1, 10);
	ctx8.fillRect(192+60, 1, 1, 10);
	ctx8.fillRect(216+60, 1, 1, 10);
	ctx8.fillRect(240+60, 1, 1, 10);
	ctx8.fillRect(264+60, 1, 1, 10);

	ctx8.fillRect(312+60, 1, 1, 10);
	ctx8.fillRect(336+60, 1, 1, 10);
	ctx8.fillRect(360+60, 1, 1, 10);
	ctx8.fillRect(384+60, 1, 1, 10);
	ctx8.fillRect(408+60, 1, 1, 10);

	ctx8.fillRect(456+60, 1, 1, 10);
	ctx8.fillRect(480+60, 1, 1, 10);
	ctx8.fillRect(504+60, 1, 1, 10);
	ctx8.fillRect(528+60, 1, 1, 10);
	ctx8.fillRect(552+60, 1, 1, 10);

//----------- Initialise Satellite Constellation Graph -----------------

	ctx9.strokeStyle = "white";
	ctx9.beginPath();
	ctx9.arc(340, 340, 299, 0, 2 * Math.PI);
	ctx9.stroke();

	ctx9.beginPath();
	ctx9.arc(340, 340, 149, 0, 2 * Math.PI);
	ctx9.stroke();

	ctx9.font = "20px Arial";
	ctx9.lineWidth = 1;
	ctx9.fillStyle="white";
	ctx9.fillText("N", 330, 30);   
	ctx9.fillText("S", 330, 670);   
	ctx9.fillText("E", 650, 350);   
	ctx9.fillText("W", 10, 350);   


	ctx9.beginPath();
	ctx9.arc(20, 20, 10, 0, 2 * Math.PI);
	ctx9.fillStyle="#00d81a"; //green
	ctx9.fill();
	ctx9.fillStyle="white";
	ctx9.fillText("= USA", 37, 27);  

	ctx9.beginPath();
	ctx9.arc(20, 45, 10, 0, 2 * Math.PI);
	ctx9.fillStyle="#ffec02"; //yellow
	ctx9.fill();
	ctx9.fillStyle="white";
	ctx9.fillText("= China", 37, 52);  

	ctx9.beginPath();
	ctx9.arc(20, 70, 10, 0, 2 * Math.PI);
	ctx9.fillStyle="red"; //red
	ctx9.fill();
	ctx9.fillStyle="white";
	ctx9.fillText("= Russia", 37, 77);  

	ctx9.beginPath();
	ctx9.arc(20, 95, 10, 0, 2 * Math.PI);
	ctx9.fillStyle="#00a6ff"; //blue
	ctx9.fill();
	ctx9.fillStyle="white";
	ctx9.fillText("= EU", 37, 102);  


	ctx9.beginPath();
	ctx9.arc(590, 20, 7, 0, 2 * Math.PI);
	ctx9.strokeStyle = "#00d81a"; //green
	ctx9.stroke();
	ctx9.fillStyle="white";
	ctx9.fillText("Visible", 610, 27);  

	ctx9.beginPath();
	ctx9.arc(590, 45, 10, 0, 2 * Math.PI);
	ctx9.fillStyle="#00d81a"; //green
	ctx9.fill();
	ctx9.fillStyle="white";
	ctx9.fillText("Fixed", 610, 52);  


//------- Initialise Satellite Signal Level Graph -----------------

	ctx10.clearRect(20, 259, 640, 20);
	ctx10.fillStyle = "#2A4059";
	ctx10.fillRect(60, 1, 578, 257);
	ctx10.font = "15px Arial";
	ctx10.lineWidth = 1;
        ctx10.fillStyle="white";
	ctx10.fillText("50", 35, 11);   
	ctx10.fillText("45", 35, 31);   
	ctx10.fillText("40", 35, 57);   
	ctx10.fillText("35", 35, 83);   
	ctx10.fillText("30", 35, 109);   
	ctx10.fillText("25", 35, 135);   
	ctx10.fillText("20", 35, 161);   
	ctx10.fillText("15", 35, 187); 
	ctx10.fillText("10", 35, 213); 
	ctx10.fillText("5", 42, 239); 
	ctx10.fillText("0", 42, 265); 

	ctx10.fillText("USA", 115, 280); 
	ctx10.fillText("China", 255, 280); 
	ctx10.fillText("Russia", 400, 280); 
	ctx10.fillText("EU", 560, 280); 

	ctx10.fillStyle = "black";	
	ctx10.fillRect(144+60, 1, 1, 256);
	ctx10.fillRect(288+60, 1, 1, 256);
	ctx10.fillRect(432+60, 1, 1, 256);



}




</script>

</html>
